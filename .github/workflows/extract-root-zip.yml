name: Extract zip and Push

on:
  push:
    paths:
      - 'HoldableTemplate_scotland2_ready.zip'
  workflow_dispatch:

jobs:
  extract-and-push:
    runs-on: ubuntu-latest

    steps:
      # Checkout with PAT so we can push
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.Test }}
          persist-credentials: true

      # Extract archive
      - name: Extract zip
        run: |
          set -e
          unzip -o "HoldableTemplate_scotland2_ready.zip"

      # Move extracted contents to repo root (flatten)
      - name: Move extracted contents to root
        run: |
          set -e

          if [ -d "HoldableTemplate_scotland2_ready" ]; then
            echo "üìÅ Found wrapper folder ‚Äî flattening..."
            shopt -s dotglob
            mv HoldableTemplate_scotland2_ready/* .
            rm -rf HoldableTemplate_scotland2_ready
          else
            echo "‚ÑπÔ∏è No wrapper folder found ‚Äî files already at root"
          fi

      # Remove zip after extraction
      - name: Remove zip
        run: rm -f HoldableTemplate_scotland2_ready.zip

      # Commit and push only if something changed
      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          git add -A

          if ! git diff --cached --quiet; then
            git commit -m "Extract zip and move HoldableTemplate to root"
            git push
          else
            echo "No changes to commit"
          fi
