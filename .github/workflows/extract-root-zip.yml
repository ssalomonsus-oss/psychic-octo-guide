name: Extract root zip

on:
  push:
  workflow_dispatch:

jobs:
  extract:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract and flatten zip
        run: |
          set -e

          echo "üîç Looking for zip in root..."
          ZIP_FILE=$(find . -maxdepth 1 -type f -name "*.zip" -print -quit)

          if [ -z "$ZIP_FILE" ]; then
            echo "‚ùå No zip found in repo root"
            exit 1
          fi

          echo "üì¶ Extracting $ZIP_FILE..."
          unzip -o "$ZIP_FILE"

          echo "üîç Checking for single extracted folder..."

          # find top-level directories (excluding .git)
          DIR_COUNT=$(find . -maxdepth 1 -type d ! -name "." ! -name ".git" | wc -l)

          if [ "$DIR_COUNT" -eq 1 ]; then
            TOP_DIR=$(find . -maxdepth 1 -type d ! -name "." ! -name ".git")
            echo "üìÅ Found wrapper folder: $TOP_DIR"
            echo "üöö Moving contents to root..."
            shopt -s dotglob
            mv "$TOP_DIR"/* .
            rm -rf "$TOP_DIR"
          else
            echo "‚ÑπÔ∏è No wrapper folder detected (or multiple folders)"
          fi

          echo "üßπ Removing zip..."
          rm "$ZIP_FILE"

          echo "‚úÖ Final root contents:"
          ls -la
